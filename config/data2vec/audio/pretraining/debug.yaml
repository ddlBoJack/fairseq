# @package _group_

common:
  fp16: true
  log_format: json
  log_interval: 1
  tensorboard_logdir: ???

checkpoint:
  save_interval_updates: 1
  keep_interval_updates: 1
  no_epoch_checkpoints: true

task:
  _name: audio_pretraining
  data: ???
  max_sample_size: 320000
  min_sample_size: 32000
  normalize: true

dataset:
  num_workers: 1
  max_tokens: 1400000
  skip_invalid_size_inputs_valid_test: true
  validate_interval_updates: 5
  required_batch_size_multiple: 1
  disable_validation: true

distributed_training:
  distributed_world_size: 1
  ddp_backend: legacy_ddp

criterion:
  _name: model
  log_keys:
    - ema_decay
    - target_var
    - pred_var

optimization:
  max_update: 400000
  lr: [0.0005]
  update_freq: [2]

optimizer:
  _name: adam
  adam_betas: (0.9,0.98)
  adam_eps: 1e-06
  weight_decay: 0.01

lr_scheduler:
  _name: tri_stage
  phase_ratio: [0.03,0.9,0.07]

model:
  _name: data2vec_audio
  extractor_mode: layer_norm
  encoder_layerdrop: 0.05
  dropout_input: 0.0
  dropout_features: 0.0
  feature_grad_mult: 1.0
  encoder_embed_dim: 768

  mask_prob: 0.65
  mask_length: 10

  loss_beta: 0.25
  loss_scale: null

  instance_norm_target_layer: true
  average_top_k_layers: 8

  pos_conv_depth: 5
  conv_pos: 95

  ema_decay: 0.999
  ema_end_decay: 0.9999
  ema_anneal_end_step: 30000
  ema_transformer_only: true
  ema_layers_only: false

  require_same_masks: true
  mask_dropout: 0
  
  ### reproduce  
  # attend_masked_steps: true
  # attend_masked_steps_starting: -1
  # attention_layer_norm: false
  # average_layers: true
  # contrastive_average_top_k_layers: 0
  # contrastive_layer_source: "END_OF_BLOCK"
  # contrastive_loss_schedule: null
  # contrastive_target_layer: -1
  # conv_feature_no_norm_on_1d: true
  # conv_pos_every_layer: false
  # conv_pos_shared: false
  # # diversity_weight: 0.1
  # feature_mag_pen: false
  # fixup_init: false
  # instance_norm_pred: false
  # l1_magnitude_penalty: false
  # layer_result_source: "FC"
  # magnitude_penalty: 0.0
  # mask_anneal_end_step: 0
  # max_magnitude_penalty: false
  # new_post_proj: false
  # next_target_layer: -1
  # no_ema_after_updates: -1
  # no_ln: false
  # nomag_weight_norm: false
  # non_uniform_weights_starting: 400000
  # normalize: true
  # p1_norm_target_layer: false
  # p2_norm_target_layer: false
  # post_proj_affine: true
  # post_proj_depth: 1
  # post_proj_gelu: false
  # pretrained_final_proj: false
  # pretrained_final_proj2: false
  # pretrained_model_path: null
  # proj_layers: 1
  # proj_ln: false
  # proj_transformer_layers: false
  # quantize_targets: true
  # reduce_corr_loss: false
  # regressive_loss_schedule: null
  # target_glu: false
  # >         "separate_heads": false,
  # >         "separate_var": false,
  # >         "softmax_target_layer": false,
  # >         "squeeze_avg": false,
  # >         "squeeze_factor": 0,
  # >         "stable_arch": false,
  # >         "sync_var": false,
  # >         "target_glu": false,
  # >         "target_layer": 7,
  # >         "target_layer_schedule": null,
  # >         "target_linspace_from_uniform": true,
  # >         "target_linspace_sharpen": 1.0,
  # >         "target_loss_type": "L2",
  # >         "target_masked_only": true,
  # >         "target_network_path": "",
  # >         "transformer_feature_pen": false,
  # >         "transformer_layer_type": "TRANSFORMER",
  # >         "var_batch_margin": 0.5,
  # >         "var_batch_weight": 0.0,
  # >         "var_fc2s": false,
  # >         "var_fc2s_layer": -1,
  # >         "var_fc2s_stacked": false,
  # >         "var_float": false,
  # >         "var_global_margin": 0.25,
  # >         "var_global_weight": 0.0,
  # >         "var_global_weight_schedule": null,
  # >         "var_margin": 0.5,
  # >         "var_masked_global_margin": 0.35,
  # >         "var_masked_global_weight": 0.0,
  # >         "var_masked_global_weight_schedule": null,
  # >         "var_over_time": false,
  # >         "var_projector_masked_global_margin": 0.35,
  # >         "var_projector_masked_global_weight": 0.0,
  # >         "var_time_margin": 0.1,
  # >         "var_time_weight": 0.0,
  # >         "var_weight": 0.0,
  # >         "var_xs": [],
  # >         "weight_norm": false